{"version":3,"file":"portability.js","sourceRoot":"","sources":["portability.ts"],"names":[],"mappings":"AAOA,OAAO,EAAC,YAAY,EAAC,MAAM,2BAA2B,CAAC;AACvD,OAAO,EAAC,IAAI,EAAC,MAAM,MAAM,CAAC;AAC1B,OAAO,EAAC,MAAM,EAAC,MAAM,IAAI,CAAC;AAC1B,OAAO,EAAC,EAAE,EAAE,OAAO,EAAE,EAAE,EAAC,MAAM,aAAa,CAAC;AAC5C,OAAO,EAAC,2BAA2B,EAAC,MAAM,4BAA4B,CAAC;AACvE,OAAO,EAAC,GAAG,EAAC,MAAM,qBAAqB,CAAC;AAExC,MAAM,CAAC,KAAK,UAAU,gBAAgB;IACpC,GAAG,CAAC,KAAK,CAAC,yDAAyD,CAAC,CAAC;IACrE,MAAM,YAAY,GAAG,MAAM,OAAO,CAAC,IAAI,CAAC,MAAM,EAAE,EAAE,sBAAsB,CAAC,CAAC,CAAC;IAC3E,MAAM,WAAW,GAAG,2BAA2B,EAAE,CAAC;IAClD,IAAI,CAAC;QACH,MAAM,EAAE,CAAC,IAAI,CAAC,WAAW,EAAE,SAAS,CAAC,EAAE,YAAY,EAAE,EAAC,SAAS,EAAE,IAAI,EAAC,CAAC,CAAC;QACxE,GAAG,CAAC,KAAK,CAAC,6CAA6C,CAAC,CAAC;QACzD,MAAM,cAAc,GAAG,IAAI,CAAC,YAAY,EAAE,YAAY,CAAC,CAAC;QACxD,MAAM,EAAC,MAAM,EAAE,MAAM,EAAC,GAAG,MAAM,YAAY,CAAC,IAAI,CAAC,QAAQ,cAAc,EAAE,EAAE;YACzE,GAAG,EAAE,YAAY;YACjB,IAAI,EAAE,QAAQ;SACf,CAAC,CAAC;QACH,IAAI,MAAM,KAAK,CAAC,EAAE,CAAC;YACjB,MAAM,KAAK,CAAC,MAAM,CAAC,CAAC;QACtB,CAAC;IACH,CAAC;IAAC,OAAO,GAAG,EAAE,CAAC;QACb,MAAM,GAAG,CAAC;IACZ,CAAC;YAAS,CAAC;QACT,MAAM,EAAE,CAAC,YAAY,EAAE,EAAC,SAAS,EAAE,IAAI,EAAE,UAAU,EAAE,CAAC,EAAC,CAAC,CAAC;IAC3D,CAAC;AACH,CAAC","sourcesContent":["/**\n * @license\n * Copyright Google LLC\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\nimport {ChildProcess} from '../../utils/child-process';\nimport {join} from 'path';\nimport {tmpdir} from 'os';\nimport {cp, mkdtemp, rm} from 'fs/promises';\nimport {determineRepoBaseDirFromCwd} from '../../utils/repo-directory';\nimport {Log} from '../../utils/logging';\n\nexport async function checkPortability() {\n  Log.debug('Copying ng-dev configuration to isolated temp directory');\n  const tmpConfigDir = await mkdtemp(join(tmpdir(), 'ng-dev-config-check-'));\n  const repoBaseDir = determineRepoBaseDirFromCwd();\n  try {\n    await cp(join(repoBaseDir, '.ng-dev'), tmpConfigDir, {recursive: true});\n    Log.debug('Validating configuration loads in isolation');\n    const baseConfigFile = join(tmpConfigDir, 'config.mjs');\n    const {status, stderr} = await ChildProcess.exec(`node ${baseConfigFile}`, {\n      cwd: tmpConfigDir,\n      mode: 'silent',\n    });\n    if (status !== 0) {\n      throw Error(stderr);\n    }\n  } catch (err) {\n    throw err;\n  } finally {\n    await rm(tmpConfigDir, {recursive: true, maxRetries: 3});\n  }\n}\n"]}