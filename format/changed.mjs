/**
 * @license
 * Copyright Google LLC
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://angular.io/license
 */
import { GitClient } from '../utils/git/git-client.js';
import { checkFiles, formatFiles } from './format.js';
/** Yargs command builder for the command. */
function builder(argv) {
    return argv
        .option('check', {
        type: 'boolean',
        default: process.env['CI'] ? true : false,
        description: 'Run the formatter to check formatting rather than updating code format',
    })
        .positional('shaOrRef', { type: 'string' });
}
/** Yargs command handler for the command. */
async function handler({ shaOrRef, check }) {
    const git = await GitClient.get();
    const sha = shaOrRef || git.mainBranchName;
    const executionCmd = check ? checkFiles : formatFiles;
    const allChangedFilesSince = git.allChangesFilesSince(sha);
    process.exitCode = await executionCmd(allChangedFilesSince);
}
/** CLI command module. */
export const ChangedModule = {
    builder,
    handler,
    command: 'changed [shaOrRef]',
    describe: 'Run the formatter on files changed since the provided sha/ref',
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2hhbmdlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL25nLWRldi9mb3JtYXQvY2hhbmdlZC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7O0dBTUc7QUFJSCxPQUFPLEVBQUMsU0FBUyxFQUFDLE1BQU0sNEJBQTRCLENBQUM7QUFDckQsT0FBTyxFQUFDLFVBQVUsRUFBRSxXQUFXLEVBQUMsTUFBTSxhQUFhLENBQUM7QUFRcEQsNkNBQTZDO0FBQzdDLFNBQVMsT0FBTyxDQUFDLElBQVU7SUFDekIsT0FBTyxJQUFJO1NBQ1IsTUFBTSxDQUFDLE9BQU8sRUFBRTtRQUNmLElBQUksRUFBRSxTQUFTO1FBQ2YsT0FBTyxFQUFFLE9BQU8sQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsS0FBSztRQUN6QyxXQUFXLEVBQUUsd0VBQXdFO0tBQ3RGLENBQUM7U0FDRCxVQUFVLENBQUMsVUFBVSxFQUFFLEVBQUMsSUFBSSxFQUFFLFFBQVEsRUFBQyxDQUFDLENBQUM7QUFDOUMsQ0FBQztBQUVELDZDQUE2QztBQUM3QyxLQUFLLFVBQVUsT0FBTyxDQUFDLEVBQUMsUUFBUSxFQUFFLEtBQUssRUFBcUI7SUFDMUQsTUFBTSxHQUFHLEdBQUcsTUFBTSxTQUFTLENBQUMsR0FBRyxFQUFFLENBQUM7SUFDbEMsTUFBTSxHQUFHLEdBQUcsUUFBUSxJQUFJLEdBQUcsQ0FBQyxjQUFjLENBQUM7SUFDM0MsTUFBTSxZQUFZLEdBQUcsS0FBSyxDQUFDLENBQUMsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLFdBQVcsQ0FBQztJQUN0RCxNQUFNLG9CQUFvQixHQUFHLEdBQUcsQ0FBQyxvQkFBb0IsQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUMzRCxPQUFPLENBQUMsUUFBUSxHQUFHLE1BQU0sWUFBWSxDQUFDLG9CQUFvQixDQUFDLENBQUM7QUFDOUQsQ0FBQztBQUVELDBCQUEwQjtBQUMxQixNQUFNLENBQUMsTUFBTSxhQUFhLEdBQStCO0lBQ3ZELE9BQU87SUFDUCxPQUFPO0lBQ1AsT0FBTyxFQUFFLG9CQUFvQjtJQUM3QixRQUFRLEVBQUUsK0RBQStEO0NBQzFFLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgR29vZ2xlIExMQ1xuICpcbiAqIFVzZSBvZiB0aGlzIHNvdXJjZSBjb2RlIGlzIGdvdmVybmVkIGJ5IGFuIE1JVC1zdHlsZSBsaWNlbnNlIHRoYXQgY2FuIGJlXG4gKiBmb3VuZCBpbiB0aGUgTElDRU5TRSBmaWxlIGF0IGh0dHBzOi8vYW5ndWxhci5pby9saWNlbnNlXG4gKi9cblxuaW1wb3J0IHtBcmd2LCBBcmd1bWVudHMsIENvbW1hbmRNb2R1bGV9IGZyb20gJ3lhcmdzJztcblxuaW1wb3J0IHtHaXRDbGllbnR9IGZyb20gJy4uL3V0aWxzL2dpdC9naXQtY2xpZW50LmpzJztcbmltcG9ydCB7Y2hlY2tGaWxlcywgZm9ybWF0RmlsZXN9IGZyb20gJy4vZm9ybWF0LmpzJztcblxuLyoqIENvbW1hbmQgbGluZSBvcHRpb25zLiAqL1xuZXhwb3J0IGludGVyZmFjZSBPcHRpb25zIHtcbiAgc2hhT3JSZWY/OiBzdHJpbmc7XG4gIGNoZWNrOiBib29sZWFuO1xufVxuXG4vKiogWWFyZ3MgY29tbWFuZCBidWlsZGVyIGZvciB0aGUgY29tbWFuZC4gKi9cbmZ1bmN0aW9uIGJ1aWxkZXIoYXJndjogQXJndik6IEFyZ3Y8T3B0aW9ucz4ge1xuICByZXR1cm4gYXJndlxuICAgIC5vcHRpb24oJ2NoZWNrJywge1xuICAgICAgdHlwZTogJ2Jvb2xlYW4nLFxuICAgICAgZGVmYXVsdDogcHJvY2Vzcy5lbnZbJ0NJJ10gPyB0cnVlIDogZmFsc2UsXG4gICAgICBkZXNjcmlwdGlvbjogJ1J1biB0aGUgZm9ybWF0dGVyIHRvIGNoZWNrIGZvcm1hdHRpbmcgcmF0aGVyIHRoYW4gdXBkYXRpbmcgY29kZSBmb3JtYXQnLFxuICAgIH0pXG4gICAgLnBvc2l0aW9uYWwoJ3NoYU9yUmVmJywge3R5cGU6ICdzdHJpbmcnfSk7XG59XG5cbi8qKiBZYXJncyBjb21tYW5kIGhhbmRsZXIgZm9yIHRoZSBjb21tYW5kLiAqL1xuYXN5bmMgZnVuY3Rpb24gaGFuZGxlcih7c2hhT3JSZWYsIGNoZWNrfTogQXJndW1lbnRzPE9wdGlvbnM+KSB7XG4gIGNvbnN0IGdpdCA9IGF3YWl0IEdpdENsaWVudC5nZXQoKTtcbiAgY29uc3Qgc2hhID0gc2hhT3JSZWYgfHwgZ2l0Lm1haW5CcmFuY2hOYW1lO1xuICBjb25zdCBleGVjdXRpb25DbWQgPSBjaGVjayA/IGNoZWNrRmlsZXMgOiBmb3JtYXRGaWxlcztcbiAgY29uc3QgYWxsQ2hhbmdlZEZpbGVzU2luY2UgPSBnaXQuYWxsQ2hhbmdlc0ZpbGVzU2luY2Uoc2hhKTtcbiAgcHJvY2Vzcy5leGl0Q29kZSA9IGF3YWl0IGV4ZWN1dGlvbkNtZChhbGxDaGFuZ2VkRmlsZXNTaW5jZSk7XG59XG5cbi8qKiBDTEkgY29tbWFuZCBtb2R1bGUuICovXG5leHBvcnQgY29uc3QgQ2hhbmdlZE1vZHVsZTogQ29tbWFuZE1vZHVsZTx7fSwgT3B0aW9ucz4gPSB7XG4gIGJ1aWxkZXIsXG4gIGhhbmRsZXIsXG4gIGNvbW1hbmQ6ICdjaGFuZ2VkIFtzaGFPclJlZl0nLFxuICBkZXNjcmliZTogJ1J1biB0aGUgZm9ybWF0dGVyIG9uIGZpbGVzIGNoYW5nZWQgc2luY2UgdGhlIHByb3ZpZGVkIHNoYS9yZWYnLFxufTtcbiJdfQ==