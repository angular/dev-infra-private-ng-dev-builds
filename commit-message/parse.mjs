/**
 * @license
 * Copyright Google LLC
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://angular.io/license
 */
import { sync as parse } from 'conventional-commits-parser';
/**
 * A list of tuples expressing the fields to extract from each commit log entry. The tuple contains
 * two values, the first is the key for the property and the second is the template shortcut for the
 * git log command.
 */
const commitFields = {
    hash: '%H',
    shortHash: '%h',
    author: '%aN',
};
/** The commit fields described as git log format entries for parsing. */
export const commitFieldsAsFormat = (fields) => {
    return Object.entries(fields)
        .map(([key, value]) => `%n-${key}-%n${value}`)
        .join('');
};
/**
 * The git log format template to create git log entries for parsing.
 *
 * The conventional commits parser expects to parse the standard git log raw body (%B) into its
 * component parts. Additionally it will parse additional fields with keys defined by
 * `-{key name}-` separated by new lines.
 * */
export const gitLogFormatForParsing = `%B${commitFieldsAsFormat(commitFields)}`;
/** Markers used to denote the start of a note section in a commit. */
var NoteSections;
(function (NoteSections) {
    NoteSections["BREAKING_CHANGE"] = "BREAKING CHANGE";
    NoteSections["DEPRECATED"] = "DEPRECATED";
})(NoteSections || (NoteSections = {}));
/** Regex determining if a commit is a fixup. */
const FIXUP_PREFIX_RE = /^fixup! /i;
/** Regex determining if a commit is a squash. */
const SQUASH_PREFIX_RE = /^squash! /i;
/** Regex determining if a commit is a revert. */
const REVERT_PREFIX_RE = /^revert:? /i;
/**
 * Regex pattern for parsing the header line of a commit.
 *
 * Several groups are being matched to be used in the parsed commit object, being mapped to the
 * `headerCorrespondence` object.
 *
 * The pattern can be broken down into component parts:
 * - `(\w+)` - a capturing group discovering the type of the commit.
 * - `(?:\(([^)]+)\))?` - an optional capturing group to capture the scope of the commit.
 * - `(.*)` - a capturing group discovering the subject of the commit.
 */
const headerPattern = /^(\w+)(?:\(([^)]+)\))?: (.*)$/;
/**
 * The property names used for the values extracted from the header via the
 * `headerPattern` regex.
 */
const headerCorrespondence = ['type', 'scope', 'subject'];
/**
 * Configuration options for the commit parser.
 *
 * NOTE: An extended type from `Options` must be used because the current
 * @types/conventional-commits-parser version does not include the `notesPattern` field.
 */
const parseOptions = {
    commentChar: '#',
    headerPattern,
    headerCorrespondence,
    noteKeywords: [NoteSections.BREAKING_CHANGE, NoteSections.DEPRECATED],
    notesPattern: (keywords) => new RegExp(`^\\s*(${keywords}): ?(.*)`),
};
/** Parse a commit message into its composite parts. */
export const parseCommitMessage = parseInternal;
/** Parse a commit message from a git log entry into its composite parts. */
export const parseCommitFromGitLog = parseInternal;
function parseInternal(fullText) {
    // Ensure the fullText symbol is a `string`, even if a Buffer was provided.
    fullText = fullText.toString();
    /** The commit message text with the fixup and squash markers stripped out. */
    const strippedCommitMsg = fullText
        .replace(FIXUP_PREFIX_RE, '')
        .replace(SQUASH_PREFIX_RE, '')
        .replace(REVERT_PREFIX_RE, '');
    /** The initially parsed commit. */
    const commit = parse(strippedCommitMsg, parseOptions);
    /** A list of breaking change notes from the commit. */
    const breakingChanges = [];
    /** A list of deprecation notes from the commit. */
    const deprecations = [];
    // Extract the commit message notes by marked types into their respective lists.
    commit.notes.forEach((note) => {
        if (note.title === NoteSections.BREAKING_CHANGE) {
            breakingChanges.push(note);
        }
        else if (note.title === NoteSections.DEPRECATED) {
            deprecations.push(note);
        }
    });
    return {
        fullText,
        breakingChanges,
        deprecations,
        body: commit.body || '',
        footer: commit.footer || '',
        header: commit.header || '',
        references: commit.references,
        scope: commit.scope || '',
        subject: commit.subject || '',
        type: commit.type || '',
        isFixup: FIXUP_PREFIX_RE.test(fullText),
        isSquash: SQUASH_PREFIX_RE.test(fullText),
        isRevert: REVERT_PREFIX_RE.test(fullText),
        author: commit.author || undefined,
        hash: commit.hash || undefined,
        shortHash: commit.shortHash || undefined,
    };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFyc2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9uZy1kZXYvY29tbWl0LW1lc3NhZ2UvcGFyc2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7OztHQU1HO0FBRUgsT0FBTyxFQUFrQyxJQUFJLElBQUksS0FBSyxFQUFDLE1BQU0sNkJBQTZCLENBQUM7QUF1QzNGOzs7O0dBSUc7QUFDSCxNQUFNLFlBQVksR0FBRztJQUNuQixJQUFJLEVBQUUsSUFBSTtJQUNWLFNBQVMsRUFBRSxJQUFJO0lBQ2YsTUFBTSxFQUFFLEtBQUs7Q0FDZCxDQUFDO0FBR0YseUVBQXlFO0FBQ3pFLE1BQU0sQ0FBQyxNQUFNLG9CQUFvQixHQUFHLENBQUMsTUFBb0IsRUFBRSxFQUFFO0lBQzNELE9BQU8sTUFBTSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUM7U0FDMUIsR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLEVBQUUsS0FBSyxDQUFDLEVBQUUsRUFBRSxDQUFDLE1BQU0sR0FBRyxNQUFNLEtBQUssRUFBRSxDQUFDO1NBQzdDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztBQUNkLENBQUMsQ0FBQztBQUNGOzs7Ozs7S0FNSztBQUNMLE1BQU0sQ0FBQyxNQUFNLHNCQUFzQixHQUFHLEtBQUssb0JBQW9CLENBQUMsWUFBWSxDQUFDLEVBQUUsQ0FBQztBQUNoRixzRUFBc0U7QUFDdEUsSUFBSyxZQUdKO0FBSEQsV0FBSyxZQUFZO0lBQ2YsbURBQW1DLENBQUE7SUFDbkMseUNBQXlCLENBQUE7QUFDM0IsQ0FBQyxFQUhJLFlBQVksS0FBWixZQUFZLFFBR2hCO0FBQ0QsZ0RBQWdEO0FBQ2hELE1BQU0sZUFBZSxHQUFHLFdBQVcsQ0FBQztBQUNwQyxpREFBaUQ7QUFDakQsTUFBTSxnQkFBZ0IsR0FBRyxZQUFZLENBQUM7QUFDdEMsaURBQWlEO0FBQ2pELE1BQU0sZ0JBQWdCLEdBQUcsYUFBYSxDQUFDO0FBQ3ZDOzs7Ozs7Ozs7O0dB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Q29weXJpZ2h0IEdvb2dsZSBMTENcbiAqXG4gKiBVc2Ugb2YgdGhpcyBzb3VyY2UgY29kZSBpcyBnb3Zlcm5lZCBieSBhbiBNSVQtc3R5bGUgbGljZW5zZSB0aGF0IGNhbiBiZVxuICogZm91bmQgaW4gdGhlIExJQ0VOU0UgZmlsZSBhdCBodHRwczovL2FuZ3VsYXIuaW8vbGljZW5zZVxuICovXG5cbmltcG9ydCB7Q29tbWl0IGFzIFBhcnNlZENvbW1pdCwgT3B0aW9ucywgc3luYyBhcyBwYXJzZX0gZnJvbSAnY29udmVudGlvbmFsLWNvbW1pdHMtcGFyc2VyJztcblxuLyoqIEEgcGFyc2VkIGNvbW1pdCwgY29udGFpbmluZyB0aGUgaW5mb3JtYXRpb24gbmVlZGVkIHRvIHZhbGlkYXRlIHRoZSBjb21taXQuICovXG5leHBvcnQgaW50ZXJmYWNlIENvbW1pdCB7XG4gIC8qKiBUaGUgZnVsbCByYXcgdGV4dCBvZiB0aGUgY29tbWl0LiAqL1xuICBmdWxsVGV4dDogc3RyaW5nO1xuICAvKiogVGhlIGhlYWRlciBsaW5lIG9mIHRoZSBjb21taXQsIHdpbGwgYmUgdXNlZCBpbiB0aGUgY2hhbmdlbG9nIGVudHJpZXMuICovXG4gIGhlYWRlcjogc3RyaW5nO1xuICAvKiogVGhlIGZ1bGwgYm9keSBvZiB0aGUgY29tbWl0LCBub3QgaW5jbHVkaW5nIHRoZSBmb290ZXIuICovXG4gIGJvZHk6IHN0cmluZztcbiAgLyoqIFRoZSBmb290ZXIgb2YgdGhlIGNvbW1pdCwgY29udGFpbmluZyBpc3N1ZSByZWZlcmVuY2VzIGFuZCBub3RlIHNlY3Rpb25zLiAqL1xuICBmb290ZXI6IHN0cmluZztcbiAgLyoqIEEgbGlzdCBvZiB0aGUgcmVmZXJlbmNlcyB0byBvdGhlciBpc3N1ZXMgbWFkZSB0aHJvdWdob3V0IHRoZSBjb21taXQgbWVzc2FnZS4gKi9cbiAgcmVmZXJlbmNlczogUGFyc2VkQ29tbWl0LlJlZmVyZW5jZVtdO1xuICAvKiogVGhlIHR5cGUgb2YgdGhlIGNvbW1pdCBtZXNzYWdlLiAqL1xuICB0eXBlOiBzdHJpbmc7XG4gIC8qKiBUaGUgc2NvcGUgb2YgdGhlIGNvbW1pdCBtZXNzYWdlLiAqL1xuICBzY29wZTogc3RyaW5nO1xuICAvKiogVGhlIHN1YmplY3Qgb2YgdGhlIGNvbW1pdCBtZXNzYWdlLiAqL1xuICBzdWJqZWN0OiBzdHJpbmc7XG4gIC8qKiBBIGxpc3Qgb2YgYnJlYWtpbmcgY2hhbmdlIG5vdGVzIGluIHRoZSBjb21taXQgbWVzc2FnZS4gKi9cbiAgYnJlYWtpbmdDaGFuZ2VzOiBQYXJzZWRDb21taXQuTm90ZVtdO1xuICAvKiogQSBsaXN0IG9mIGRlcHJlY2F0aW9uIG5vdGVzIGluIHRoZSBjb21taXQgbWVzc2FnZS4gKi9cbiAgZGVwcmVjYXRpb25zOiBQYXJzZWRDb21taXQuTm90ZVtdO1xuICAvKiogV2hldGhlciB0aGUgY29tbWl0IGlzIGEgZml4dXAgY29tbWl0LiAqL1xuICBpc0ZpeHVwOiBib29sZWFuO1xuICAvKiogV2hldGhlciB0aGUgY29tbWl0IGlzIGEgc3F1YXNoIGNvbW1pdC4gKi9cbiAgaXNTcXVhc2g6IGJvb2xlYW47XG4gIC8qKiBXaGV0aGVyIHRoZSBjb21taXQgaXMgYSByZXZlcnQgY29tbWl0LiAqL1xuICBpc1JldmVydDogYm9vbGVhbjtcbn1cblxuLyoqIEEgcGFyc2VkIGNvbW1pdCB3aGljaCBvcmlnaW5hdGVkIGZyb20gYSBHaXQgTG9nIGVudHJ5ICovXG5leHBvcnQgaW50ZXJmYWNlIENvbW1pdEZyb21HaXRMb2cgZXh0ZW5kcyBDb21taXQge1xuICBhdXRob3I6IHN0cmluZztcbiAgaGFzaDogc3RyaW5nO1xuICBzaG9ydEhhc2g6IHN0cmluZztcbn1cblxuLyoqXG4gKiBBIGxpc3Qgb2YgdHVwbGVzIGV4cHJlc3NpbmcgdGhlIGZpZWxkcyB0byBleHRyYWN0IGZyb20gZWFjaCBjb21taXQgbG9nIGVudHJ5LiBUaGUgdHVwbGUgY29udGFpbnNcbiAqIHR3byB2YWx1ZXMsIHRoZSBmaXJzdCBpcyB0aGUga2V5IGZvciB0aGUgcHJvcGVydHkgYW5kIHRoZSBzZWNvbmQgaXMgdGhlIHRlbXBsYXRlIHNob3J0Y3V0IGZvciB0aGVcbiAqIGdpdCBsb2cgY29tbWFuZC5cbiAqL1xuY29uc3QgY29tbWl0RmllbGRzID0ge1xuICBoYXNoOiAnJUgnLFxuICBzaG9ydEhhc2g6ICclaCcsXG4gIGF1dGhvcjogJyVhTicsXG59O1xuLyoqIFRoZSBhZGRpdGlvbmFsIGZpZWxkcyB0byBiZSBpbmNsdWRlZCBpbiBjb21taXQgbG9nIGVudHJpZXMgZm9yIHBhcnNpbmcuICovXG5leHBvcnQgdHlwZSBDb21taXRGaWVsZHMgPSB0eXBlb2YgY29tbWl0RmllbGRzO1xuLyoqIFRoZSBjb21taXQgZmllbGRzIGRlc2NyaWJlZCBhcyBnaXQgbG9nIGZvcm1hdCBlbnRyaWVzIGZvciBwYXJzaW5nLiAqL1xuZXhwb3J0IGNvbnN0IGNvbW1pdEZpZWxkc0FzRm9ybWF0ID0gKGZpZWxkczogQ29tbWl0RmllbGRzKSA9PiB7XG4gIHJldHVybiBPYmplY3QuZW50cmllcyhmaWVsZHMpXG4gICAgLm1hcCgoW2tleSwgdmFsdWVdKSA9PiBgJW4tJHtrZXl9LSVuJHt2YWx1ZX1gKVxuICAgIC5qb2luKCcnKTtcbn07XG4vKipcbiAqIFRoZSBnaXQgbG9nIGZvcm1hdCB0ZW1wbGF0ZSB0byBjcmVhdGUgZ2l0IGxvZyBlbnRyaWVzIGZvciBwYXJzaW5nLlxuICpcbiAqIFRoZSBjb252ZW50aW9uYWwgY29tbWl0cyBwYXJzZXIgZXhwZWN0cyB0byBwYXJzZSB0aGUgc3RhbmRhcmQgZ2l0IGxvZyByYXcgYm9keSAoJUIpIGludG8gaXRzXG4gKiBjb21wb25lbnQgcGFydHMuIEFkZGl0aW9uYWxseSBpdCB3aWxsIHBhcnNlIGFkZGl0aW9uYWwgZmllbGRzIHdpdGgga2V5cyBkZWZpbmVkIGJ5XG4gKiBgLXtrZXkgbmFtZX0tYCBzZXBhcmF0ZWQgYnkgbmV3IGxpbmVzLlxuICogKi9cbmV4cG9ydCBjb25zdCBnaXRMb2dGb3JtYXRGb3JQYXJzaW5nID0gYCVCJHtjb21taXRGaWVsZHNBc0Zvcm1hdChjb21taXRGaWVsZHMpfWA7XG4vKiogTWFya2VycyB1c2VkIHRvIGRlbm90ZSB0aGUgc3RhcnQgb2YgYSBub3RlIHNlY3Rpb24gaW4gYSBjb21taXQuICovXG5lbnVtIE5vdGVTZWN0aW9ucyB7XG4gIEJSRUFLSU5HX0NIQU5HRSA9ICdCUkVBS0lORyBDSEFOR0UnLFxuICBERVBSRUNBVEVEID0gJ0RFUFJFQ0FURUQnLFxufVxuLyoqIFJlZ2V4IGRldGVybWluaW5nIGlmIGEgY29tbWl0IGlzIGEgZml4dXAuICovXG5jb25zdCBGSVhVUF9QUkVGSVhfUkUgPSAvXmZpeHVwISAvaTtcbi8qKiBSZWdleCBkZXRlcm1pbmluZyBpZiBhIGNvbW1pdCBpcyBhIHNxdWFzaC4gKi9cbmNvbnN0IFNRVUFTSF9QUkVGSVhfUkUgPSAvXnNxdWFzaCEgL2k7XG4vKiogUmVnZXggZGV0ZXJtaW5pbmcgaWYgYSBjb21taXQgaXMgYSByZXZlcnQuICovXG5jb25zdCBSRVZFUlRfUFJFRklYX1JFID0gL15yZXZlcnQ6PyAvaTtcbi8qKlxuICogUmVnZXggcGF0dGVybiBmb3IgcGFyc2luZyB0aGUgaGVhZGVyIGxpbmUgb2YgYSBjb21taXQuXG4gKlxuICogU2V2ZXJhbCBncm91cHMgYXJlIGJlaW5nIG1hdGNoZWQgdG8gYmUgdXNlZCBpbiB0aGUgcGFyc2VkIGNvbW1pdCBvYmplY3QsIGJlaW5nIG1hcHBlZCB0byB0aGVcbiAqIGBoZWFkZXJDb3JyZXNwb25kZW5jZWAgb2JqZWN0LlxuICpcbiAqIFRoZSBwYXR0ZXJuIGNhbiBiZSBicm9rZW4gZG93biBpbnRvIGNvbXBvbmVudCBwYXJ0czpcbiAqIC0gYChcXHcrKWAgLSBhIGNhcHR1cmluZyBncm91cCBkaXNjb3ZlcmluZyB0aGUgdHlwZSBvZiB0aGUgY29tbWl0LlxuICogLSBgKD86XFwoKFteKV0rKVxcKSk/YCAtIGFuIG9wdGlvbmFsIGNhcHR1cmluZyBncm91cCB0byBjYXB0dXJlIHRoZSBzY29wZSBvZiB0aGUgY29tbWl0LlxuICogLSBgKC4qKWAgLSBhIGNhcHR1cmluZyBncm91cCBkaXNjb3ZlcmluZyB0aGUgc3ViamVjdCBvZiB0aGUgY29tbWl0LlxuICovXG5jb25zdCBoZWFkZXJQYXR0ZXJuID0gL14oXFx3KykoPzpcXCgoW14pXSspXFwpKT86ICguKikkLztcbi8qKlxuICogVGhlIHByb3BlcnR5IG5hbWVzIHVzZWQgZm9yIHRoZSB2YWx1ZXMgZXh0cmFjdGVkIGZyb20gdGhlIGhlYWRlciB2aWEgdGhlXG4gKiBgaGVhZGVyUGF0dGVybmAgcmVnZXguXG4gKi9cbmNvbnN0IGhlYWRlckNvcnJlc3BvbmRlbmNlID0gWyd0eXBlJywgJ3Njb3BlJywgJ3N1YmplY3QnXTtcbi8qKlxuICogQ29uZmlndXJhdGlvbiBvcHRpb25zIGZvciB0aGUgY29tbWl0IHBhcnNlci5cbiAqXG4gKiBOT1RFOiBBbiBleHRlbmRlZCB0eXBlIGZyb20gYE9wdGlvbnNgIG11c3QgYmUgdXNlZCBiZWNhdXNlIHRoZSBjdXJyZW50XG4gKiBAdHlwZXMvY29udmVudGlvbmFsLWNvbW1pdHMtcGFyc2VyIHZlcnNpb24gZG9lcyBub3QgaW5jbHVkZSB0aGUgYG5vdGVzUGF0dGVybmAgZmllbGQuXG4gKi9cbmNvbnN0IHBhcnNlT3B0aW9uczogT3B0aW9ucyAmIHtub3Rlc1BhdHRlcm46IChrZXl3b3Jkczogc3RyaW5nKSA9PiBSZWdFeHB9ID0ge1xuICBjb21tZW50Q2hhcjogJyMnLFxuICBoZWFkZXJQYXR0ZXJuLFxuICBoZWFkZXJDb3JyZXNwb25kZW5jZSxcbiAgbm90ZUtleXdvcmRzOiBbTm90ZVNlY3Rpb25zLkJSRUFLSU5HX0NIQU5HRSwgTm90ZVNlY3Rpb25zLkRFUFJFQ0FURURdLFxuICBub3Rlc1BhdHRlcm46IChrZXl3b3Jkczogc3RyaW5nKSA9PiBuZXcgUmVnRXhwKGBeXFxcXHMqKCR7a2V5d29yZHN9KTogPyguKilgKSxcbn07XG5cbi8qKiBQYXJzZSBhIGNvbW1pdCBtZXNzYWdlIGludG8gaXRzIGNvbXBvc2l0ZSBwYXJ0cy4gKi9cbmV4cG9ydCBjb25zdCBwYXJzZUNvbW1pdE1lc3NhZ2U6IChmdWxsVGV4dDogc3RyaW5nKSA9PiBDb21taXQgPSBwYXJzZUludGVybmFsO1xuXG4vKiogUGFyc2UgYSBjb21taXQgbWVzc2FnZSBmcm9tIGEgZ2l0IGxvZyBlbnRyeSBpbnRvIGl0cyBjb21wb3NpdGUgcGFydHMuICovXG5leHBvcnQgY29uc3QgcGFyc2VDb21taXRGcm9tR2l0TG9nOiAoZnVsbFRleHQ6IEJ1ZmZlcikgPT4gQ29tbWl0RnJvbUdpdExvZyA9IHBhcnNlSW50ZXJuYWw7XG5cbi8qKiBQYXJzZSBhIGZ1bGwgY29tbWl0IG1lc3NhZ2UgaW50byBpdHMgY29tcG9zaXRlIHBhcnRzLiAqL1xuZnVuY3Rpb24gcGFyc2VJbnRlcm5hbChmdWxsVGV4dDogc3RyaW5nKTogQ29tbWl0O1xuZnVuY3Rpb24gcGFyc2VJbnRlcm5hbChmdWxsVGV4dDogQnVmZmVyKTogQ29tbWl0RnJvbUdpdExvZztcbmZ1bmN0aW9uIHBhcnNlSW50ZXJuYWwoZnVsbFRleHQ6IHN0cmluZyB8IEJ1ZmZlcik6IENvbW1pdEZyb21HaXRMb2cgfCBDb21taXQge1xuICAvLyBFbnN1cmUgdGhlIGZ1bGxUZXh0IHN5bWJvbCBpcyBhIGBzdHJpbmdgLCBldmVuIGlmIGEgQnVmZmVyIHdhcyBwcm92aWRlZC5cbiAgZnVsbFRleHQgPSBmdWxsVGV4dC50b1N0cmluZygpO1xuICAvKiogVGhlIGNvbW1pdCBtZXNzYWdlIHRleHQgd2l0aCB0aGUgZml4dXAgYW5kIHNxdWFzaCBtYXJrZXJzIHN0cmlwcGVkIG91dC4gKi9cbiAgY29uc3Qgc3RyaXBwZWRDb21taXRNc2cgPSBmdWxsVGV4dFxuICAgIC5yZXBsYWNlKEZJWFVQX1BSRUZJWF9SRSwgJycpXG4gICAgLnJlcGxhY2UoU1FVQVNIX1BSRUZJWF9SRSwgJycpXG4gICAgLnJlcGxhY2UoUkVWRVJUX1BSRUZJWF9SRSwgJycpO1xuICAvKiogVGhlIGluaXRpYWxseSBwYXJzZWQgY29tbWl0LiAqL1xuICBjb25zdCBjb21taXQgPSBwYXJzZShzdHJpcHBlZENvbW1pdE1zZywgcGFyc2VPcHRpb25zKTtcbiAgLyoqIEEgbGlzdCBvZiBicmVha2luZyBjaGFuZ2Ugbm90ZXMgZnJvbSB0aGUgY29tbWl0LiAqL1xuICBjb25zdCBicmVha2luZ0NoYW5nZXM6IFBhcnNlZENvbW1pdC5Ob3RlW10gPSBbXTtcbiAgLyoqIEEgbGlzdCBvZiBkZXByZWNhdGlvbiBub3RlcyBmcm9tIHRoZSBjb21taXQuICovXG4gIGNvbnN0IGRlcHJlY2F0aW9uczogUGFyc2VkQ29tbWl0Lk5vdGVbXSA9IFtdO1xuXG4gIC8vIEV4dHJhY3QgdGhlIGNvbW1pdCBtZXNzYWdlIG5vdGVzIGJ5IG1hcmtlZCB0eXBlcyBpbnRvIHRoZWlyIHJlc3BlY3RpdmUgbGlzdHMuXG4gIGNvbW1pdC5ub3Rlcy5mb3JFYWNoKChub3RlOiBQYXJzZWRDb21taXQuTm90ZSkgPT4ge1xuICAgIGlmIChub3RlLnRpdGxlID09PSBOb3RlU2VjdGlvbnMuQlJFQUtJTkdfQ0hBTkdFKSB7XG4gICAgICBicmVha2luZ0NoYW5nZXMucHVzaChub3RlKTtcbiAgICB9IGVsc2UgaWYgKG5vdGUudGl0bGUgPT09IE5vdGVTZWN0aW9ucy5ERVBSRUNBVEVEKSB7XG4gICAgICBkZXByZWNhdGlvbnMucHVzaChub3RlKTtcbiAgICB9XG4gIH0pO1xuXG4gIHJldHVybiB7XG4gICAgZnVsbFRleHQsXG4gICAgYnJlYWtpbmdDaGFuZ2VzLFxuICAgIGRlcHJlY2F0aW9ucyxcbiAgICBib2R5OiBjb21taXQuYm9keSB8fCAnJyxcbiAgICBmb290ZXI6IGNvbW1pdC5mb290ZXIgfHwgJycsXG4gICAgaGVhZGVyOiBjb21taXQuaGVhZGVyIHx8ICcnLFxuICAgIHJlZmVyZW5jZXM6IGNvbW1pdC5yZWZlcmVuY2VzLFxuICAgIHNjb3BlOiBjb21taXQuc2NvcGUgfHwgJycsXG4gICAgc3ViamVjdDogY29tbWl0LnN1YmplY3QgfHwgJycsXG4gICAgdHlwZTogY29tbWl0LnR5cGUgfHwgJycsXG4gICAgaXNGaXh1cDogRklYVVBfUFJFRklYX1JFLnRlc3QoZnVsbFRleHQpLFxuICAgIGlzU3F1YXNoOiBTUVVBU0hfUFJFRklYX1JFLnRlc3QoZnVsbFRleHQpLFxuICAgIGlzUmV2ZXJ0OiBSRVZFUlRfUFJFRklYX1JFLnRlc3QoZnVsbFRleHQpLFxuICAgIGF1dGhvcjogY29tbWl0LmF1dGhvciB8fCB1bmRlZmluZWQsXG4gICAgaGFzaDogY29tbWl0Lmhhc2ggfHwgdW5kZWZpbmVkLFxuICAgIHNob3J0SGFzaDogY29tbWl0LnNob3J0SGFzaCB8fCB1bmRlZmluZWQsXG4gIH07XG59XG4iXX0=