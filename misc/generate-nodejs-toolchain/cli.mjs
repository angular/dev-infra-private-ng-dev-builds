import https from 'node:https';
import { Log } from '../../utils/logging.js';
function builder(argv) {
    return argv
        .positional('nodeJsVersion', {
        type: 'string',
        demandOption: true,
    })
        .check(({ nodeJsVersion }) => {
        if (!/^\d+\.\d+\.\d+$/.test(nodeJsVersion)) {
            throw new Error(`Invalid version format "${nodeJsVersion}". Expected X.Y.Z (Example: 22.11.0)`);
        }
        return true;
    });
}
/** CLI command module. */
export const GeneratedNodeJsToolchainModule = {
    builder,
    handler,
    command: 'generate-nodejs-toolchain <nodeJsVersion>',
    describe: 'Generates a Bazel toolchain definition for a specific Node.js version.',
};
const REPOSITORY_TYPES = {
    'darwin-arm64.tar.gz': 'darwin_arm64',
    'darwin-x64.tar.gz': 'darwin_amd64',
    'linux-x64.tar.xz': 'linux_amd64',
    'linux-arm64.tar.xz': 'linux_arm64',
    'linux-s390x.tar.xz': 'linux_s390x',
    'win-x64.zip': 'windows_amd64',
    'linux-ppc64le.tar.xz': 'linux_ppc64le',
};
function getText(url) {
    return new Promise((resolve, reject) => {
        const request = https.get(url, (res) => {
            if (res.statusCode !== 200) {
                return reject(new Error(`Failed to get ${url}. Status Code: ${res.statusCode ?? 'unknown'}`));
            }
            const body = [];
            res.on('data', (chunk) => body.push(chunk));
            res.on('end', () => resolve(body.join('')));
        });
        request.on('error', (err) => reject(err));
    });
}
async function getNodeJsRepositories(version) {
    const text = await getText(`https://nodejs.org/dist/v${version}/SHASUMS256.txt`);
    const repositories = text
        .split('\n')
        .filter(Boolean) // Remove empty lines
        .map((line) => {
        const [sha, filename] = line.trim().split(/\s+/);
        if (!filename) {
            return undefined;
        }
        // Extract the part of the filename that matches REPOSITORY_TYPES keys
        // Example: "node-v22.2.0-darwin-arm64.tar.gz" -> "darwin-arm64.tar.gz"
        const fileTypeSuffix = filename.replace(/^node-v[\d.]+-/, '');
        const type = REPOSITORY_TYPES[fileTypeSuffix];
        return type ? { filename, sha, type } : undefined;
    })
        .filter((repo) => repo !== undefined);
    return {
        version,
        repositories,
    };
}
async function handler({ nodeJsVersion }) {
    try {
        const { version, repositories } = await getNodeJsRepositories(nodeJsVersion);
        if (!repositories?.length) {
            Log.error(`  ✘   Could not find any downloadable files for Node.js version ${version}. ` +
                `Please check if the version exists and has published binaries at https://nodejs.org/dist/v${version}/`);
            process.exit(1);
        }
        const [majorVersion] = version.split('.');
        console.log(`nodejs_register_toolchains(`);
        console.log(`    name = "node${majorVersion}",`);
        console.log(`    node_repositories = {`);
        for (const { filename, sha, type } of repositories) {
            // Remove file extension (.zip, .tar.xr .tar.gz etc...)
            const strippedFilename = filename.replace(/(\.tar)?\.[^.]+$/, '');
            console.log(`        "${version}-${type}": ("${filename}", "${strippedFilename}", "${sha}"),`);
        }
        console.log(`    },`);
        console.log(`    node_version = "${version}",`);
        console.log(`)\n`);
    }
    catch (error) {
        Log.error(`  ✘  Aborted due to an error:\n${error}`);
        process.exit(1);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2xpLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vbmctZGV2L21pc2MvZ2VuZXJhdGUtbm9kZWpzLXRvb2xjaGFpbi9jbGkudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxLQUFLLE1BQU0sWUFBWSxDQUFDO0FBQy9CLE9BQU8sRUFBQyxHQUFHLEVBQUMsTUFBTSx3QkFBd0IsQ0FBQztBQW1CM0MsU0FBUyxPQUFPLENBQUMsSUFBVTtJQUN6QixPQUFPLElBQUk7U0FDUixVQUFVLENBQUMsZUFBZSxFQUFFO1FBQzNCLElBQUksRUFBRSxRQUFRO1FBQ2QsWUFBWSxFQUFFLElBQUk7S0FDbkIsQ0FBQztTQUNELEtBQUssQ0FBQyxDQUFDLEVBQUMsYUFBYSxFQUFDLEVBQUUsRUFBRTtRQUN6QixJQUFJLENBQUMsaUJBQWlCLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxFQUFFLENBQUM7WUFDM0MsTUFBTSxJQUFJLEtBQUssQ0FDYiwyQkFBMkIsYUFBYSxzQ0FBc0MsQ0FDL0UsQ0FBQztRQUNKLENBQUM7UUFFRCxPQUFPLElBQUksQ0FBQztJQUNkLENBQUMsQ0FBQyxDQUFDO0FBQ1AsQ0FBQztBQUVELDBCQUEwQjtBQUMxQixNQUFNLENBQUMsTUFBTSw4QkFBOEIsR0FBc0Q7SUFDL0YsT0FBTztJQUNQLE9BQU87SUFDUCxPQUFPLEVBQUUsMkNBQTJDO0lBQ3BELFFBQVEsRUFBRSx3RUFBd0U7Q0FDbkYsQ0FBQztBQUVGLE1BQU0sZ0JBQWdCLEdBQTJCO0lBQy9DLHFCQUFxQixFQUFFLGNBQWM7SUFDckMsbUJBQW1CLEVBQUUsY0FBYztJQUNuQyxrQkFBa0IsRUFBRSxhQUFhO0lBQ2pDLG9CQUFvQixFQUFFLGFBQWE7SUFDbkMsb0JBQW9CLEVBQUUsYUFBYTtJQUNuQyxhQUFhLEVBQUUsZUFBZTtJQUM5QixzQkFBc0IsRUFBRSxlQUFlO0NBQ3hDLENBQUM7QUFFRixTQUFTLE9BQU8sQ0FBQyxHQUFXO0lB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LENBQUMsQ0FBQztRQUMzQyxPQUFPLENBQUMsR0FBRyxDQUFDLG1CQUFtQixZQUFZLElBQUksQ0FBQyxDQUFDO1FBQ2pELE9BQU8sQ0FBQyxHQUFHLENBQUMsMkJBQTJCLENBQUMsQ0FBQztRQUV6QyxLQUFLLE1BQU0sRUFBQyxRQUFRLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBQyxJQUFJLFlBQVksRUFBRSxDQUFDO1lBQ2pELHVEQUF1RDtZQUN2RCxNQUFNLGdCQUFnQixHQUFHLFFBQVEsQ0FBQyxPQUFPLENBQUMsa0JBQWtCLEVBQUUsRUFBRSxDQUFDLENBQUM7WUFDbEUsT0FBTyxDQUFDLEdBQUcsQ0FDVCxZQUFZLE9BQU8sSUFBSSxJQUFJLFFBQVEsUUFBUSxPQUFPLGdCQUFnQixPQUFPLEdBQUcsS0FBSyxDQUNsRixDQUFDO1FBQ0osQ0FBQztRQUVELE9BQU8sQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDdEIsT0FBTyxDQUFDLEdBQUcsQ0FBQyx1QkFBdUIsT0FBTyxJQUFJLENBQUMsQ0FBQztRQUNoRCxPQUFPLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ3JCLENBQUM7SUFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO1FBQ2YsR0FBRyxDQUFDLEtBQUssQ0FBQyxrQ0FBa0MsS0FBSyxFQUFFLENBQUMsQ0FBQztRQUNyRCxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ2xCLENBQUM7QUFDSCxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGh0dHBzIGZyb20gJ25vZGU6aHR0cHMnO1xuaW1wb3J0IHtMb2d9IGZyb20gJy4uLy4uL3V0aWxzL2xvZ2dpbmcuanMnO1xuaW1wb3J0IHtBcmd1bWVudHMsIEFyZ3YsIENvbW1hbmRNb2R1bGV9IGZyb20gJ3lhcmdzJztcblxuaW50ZXJmYWNlIFJlcG9zaXRvcnlJbmZvIHtcbiAgZmlsZW5hbWU6IHN0cmluZztcbiAgc2hhOiBzdHJpbmc7XG4gIHR5cGU6IHN0cmluZztcbn1cblxuaW50ZXJmYWNlIE5vZGVWZXJzaW9uRGF0YSB7XG4gIHZlcnNpb246IHN0cmluZztcbiAgcmVwb3NpdG9yaWVzOiBSZXBvc2l0b3J5SW5mb1tdO1xufVxuXG4vKiogQ29tbWFuZCBsaW5lIG9wdGlvbnMuICovXG5leHBvcnQgaW50ZXJmYWNlIEdlbmVyYXRlTm9kZUpzVG9vbGNoYWluT3B0aW9ucyB7XG4gIG5vZGVKc1ZlcnNpb246IHN0cmluZztcbn1cblxuZnVuY3Rpb24gYnVpbGRlcihhcmd2OiBBcmd2KTogQXJndjxHZW5lcmF0ZU5vZGVKc1Rvb2xjaGFpbk9wdGlvbnM+IHtcbiAgcmV0dXJuIGFyZ3ZcbiAgICAucG9zaXRpb25hbCgnbm9kZUpzVmVyc2lvbicsIHtcbiAgICAgIHR5cGU6ICdzdHJpbmcnLFxuICAgICAgZGVtYW5kT3B0aW9uOiB0cnVlLFxuICAgIH0pXG4gICAgLmNoZWNrKCh7bm9kZUpzVmVyc2lvbn0pID0+IHtcbiAgICAgIGlmICghL15cXGQrXFwuXFxkK1xcLlxcZCskLy50ZXN0KG5vZGVKc1ZlcnNpb24pKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICBgSW52YWxpZCB2ZXJzaW9uIGZvcm1hdCBcIiR7bm9kZUpzVmVyc2lvbn1cIi4gRXhwZWN0ZWQgWC5ZLlogKEV4YW1wbGU6IDIyLjExLjApYCxcbiAgICAgICAgKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSk7XG59XG5cbi8qKiBDTEkgY29tbWFuZCBtb2R1bGUuICovXG5leHBvcnQgY29uc3QgR2VuZXJhdGVkTm9kZUpzVG9vbGNoYWluTW9kdWxlOiBDb21tYW5kTW9kdWxlPHt9LCBHZW5lcmF0ZU5vZGVKc1Rvb2xjaGFpbk9wdGlvbnM+ID0ge1xuICBidWlsZGVyLFxuICBoYW5kbGVyLFxuICBjb21tYW5kOiAnZ2VuZXJhdGUtbm9kZWpzLXRvb2xjaGFpbiA8bm9kZUpzVmVyc2lvbj4nLFxuICBkZXNjcmliZTogJ0dlbmVyYXRlcyBhIEJhemVsIHRvb2xjaGFpbiBkZWZpbml0aW9uIGZvciBhIHNwZWNpZmljIE5vZGUuanMgdmVyc2lvbi4nLFxufTtcblxuY29uc3QgUkVQT1NJVE9SWV9UWVBFUzogUmVjb3JkPHN0cmluZywgc3RyaW5nPiA9IHtcbiAgJ2Rhcndpbi1hcm02NC50YXIuZ3onOiAnZGFyd2luX2FybTY0JyxcbiAgJ2Rhcndpbi14NjQudGFyLmd6JzogJ2Rhcndpbl9hbWQ2NCcsXG4gICdsaW51eC14NjQudGFyLnh6JzogJ2xpbnV4X2FtZDY0JyxcbiAgJ2xpbnV4LWFybTY0LnRhci54eic6ICdsaW51eF9hcm02NCcsXG4gICdsaW51eC1zMzkweC50YXIueHonOiAnbGludXhfczM5MHgnLFxuICAnd2luLXg2NC56aXAnOiAnd2luZG93c19hbWQ2NCcsXG4gICdsaW51eC1wcGM2NGxlLnRhci54eic6ICdsaW51eF9wcGM2NGxlJyxcbn07XG5cbmZ1bmN0aW9uIGdldFRleHQodXJsOiBzdHJpbmcpOiBQcm9taXNlPHN0cmluZz4ge1xuICByZXR1cm4gbmV3IFByb21pc2U8c3RyaW5nPigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgY29uc3QgcmVxdWVzdCA9IGh0dHBzLmdldCh1cmwsIChyZXMpID0+IHtcbiAgICAgIGlmIChyZXMuc3RhdHVzQ29kZSAhPT0gMjAwKSB7XG4gICAgICAgIHJldHVybiByZWplY3QoXG4gICAgICAgICAgbmV3IEVycm9yKGBGYWlsZWQgdG8gZ2V0ICR7dXJsfS4gU3RhdHVzIENvZGU6ICR7cmVzLnN0YXR1c0NvZGUgPz8gJ3Vua25vd24nfWApLFxuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBib2R5OiBzdHJpbmdbXSA9IFtdO1xuICAgICAgcmVzLm9uKCdkYXRhJywgKGNodW5rKSA9PiBib2R5LnB1c2goY2h1bmspKTtcbiAgICAgIHJlcy5vbignZW5kJywgKCkgPT4gcmVzb2x2ZShib2R5LmpvaW4oJycpKSk7XG4gICAgfSk7XG5cbiAgICByZXF1ZXN0Lm9uKCdlcnJvcicsIChlcnIpID0+IHJlamVjdChlcnIpKTtcbiAgfSk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGdldE5vZGVKc1JlcG9zaXRvcmllcyh2ZXJzaW9uOiBzdHJpbmcpOiBQcm9taXNlPE5vZGVWZXJzaW9uRGF0YT4ge1xuICBjb25zdCB0ZXh0ID0gYXdhaXQgZ2V0VGV4dChgaHR0cHM6Ly9ub2RlanMub3JnL2Rpc3QvdiR7dmVyc2lvbn0vU0hBU1VNUzI1Ni50eHRgKTtcblxuICBjb25zdCByZXBvc2l0b3JpZXM6IFJlcG9zaXRvcnlJbmZvW10gPSB0ZXh0XG4gICAgLnNwbGl0KCdcXG4nKVxuICAgIC5maWx0ZXIoQm9vbGVhbikgLy8gUmVtb3ZlIGVtcHR5IGxpbmVzXG4gICAgLm1hcCgobGluZTogc3RyaW5nKTogUmVwb3NpdG9yeUluZm8gfCB1bmRlZmluZWQgPT4ge1xuICAgICAgY29uc3QgW3NoYSwgZmlsZW5hbWVdID0gbGluZS50cmltKCkuc3BsaXQoL1xccysvKTtcbiAgICAgIGlmICghZmlsZW5hbWUpIHtcbiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICAgIH1cblxuICAgICAgLy8gRXh0cmFjdCB0aGUgcGFydCBvZiB0aGUgZmlsZW5hbWUgdGhhdCBtYXRjaGVzIFJFUE9TSVRPUllfVFlQRVMga2V5c1xuICAgICAgLy8gRXhhbXBsZTogXCJub2RlLXYyMi4yLjAtZGFyd2luLWFybTY0LnRhci5nelwiIC0+IFwiZGFyd2luLWFybTY0LnRhci5nelwiXG4gICAgICBjb25zdCBmaWxlVHlwZVN1ZmZpeCA9IGZpbGVuYW1lLnJlcGxhY2UoL15ub2RlLXZbXFxkLl0rLS8sICcnKTtcbiAgICAgIGNvbnN0IHR5cGUgPSBSRVBPU0lUT1JZX1RZUEVTW2ZpbGVUeXBlU3VmZml4XTtcblxuICAgICAgcmV0dXJuIHR5cGUgPyB7ZmlsZW5hbWUsIHNoYSwgdHlwZX0gOiB1bmRlZmluZWQ7XG4gICAgfSlcbiAgICAuZmlsdGVyKChyZXBvKTogcmVwbyBpcyBSZXBvc2l0b3J5SW5mbyA9PiByZXBvICE9PSB1bmRlZmluZWQpO1xuXG4gIHJldHVybiB7XG4gICAgdmVyc2lvbixcbiAgICByZXBvc2l0b3JpZXMsXG4gIH07XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGhhbmRsZXIoe25vZGVKc1ZlcnNpb259OiBBcmd1bWVudHM8R2VuZXJhdGVOb2RlSnNUb29sY2hhaW5PcHRpb25zPik6IFByb21pc2U8dm9pZD4ge1xuICB0cnkge1xuICAgIGNvbnN0IHt2ZXJzaW9uLCByZXBvc2l0b3JpZXN9ID0gYXdhaXQgZ2V0Tm9kZUpzUmVwb3NpdG9yaWVzKG5vZGVKc1ZlcnNpb24pO1xuICAgIGlmICghcmVwb3NpdG9yaWVzPy5sZW5ndGgpIHtcbiAgICAgIExvZy5lcnJvcihcbiAgICAgICAgYCAg4pyYICAgQ291bGQgbm90IGZpbmQgYW55IGRvd25sb2FkYWJsZSBmaWxlcyBmb3IgTm9kZS5qcyB2ZXJzaW9uICR7dmVyc2lvbn0uIGAgK1xuICAgICAgICAgIGBQbGVhc2UgY2hlY2sgaWYgdGhlIHZlcnNpb24gZXhpc3RzIGFuZCBoYXMgcHVibGlzaGVkIGJpbmFyaWVzIGF0IGh0dHBzOi8vbm9kZWpzLm9yZy9kaXN0L3Yke3ZlcnNpb259L2AsXG4gICAgICApO1xuICAgICAgcHJvY2Vzcy5leGl0KDEpO1xuICAgIH1cblxuICAgIGNvbnN0IFttYWpvclZlcnNpb25dID0gdmVyc2lvbi5zcGxpdCgnLicpO1xuICAgIGNvbnNvbGUubG9nKGBub2RlanNfcmVnaXN0ZXJfdG9vbGNoYWlucyhgKTtcbiAgICBjb25zb2xlLmxvZyhgICAgIG5hbWUgPSBcIm5vZGUke21ham9yVmVyc2lvbn1cIixgKTtcbiAgICBjb25zb2xlLmxvZyhgICAgIG5vZGVfcmVwb3NpdG9yaWVzID0ge2ApO1xuXG4gICAgZm9yIChjb25zdCB7ZmlsZW5hbWUsIHNoYSwgdHlwZX0gb2YgcmVwb3NpdG9yaWVzKSB7XG4gICAgICAvLyBSZW1vdmUgZmlsZSBleHRlbnNpb24gKC56aXAsIC50YXIueHIgLnRhci5neiBldGMuLi4pXG4gICAgICBjb25zdCBzdHJpcHBlZEZpbGVuYW1lID0gZmlsZW5hbWUucmVwbGFjZSgvKFxcLnRhcik/XFwuW14uXSskLywgJycpO1xuICAgICAgY29uc29sZS5sb2coXG4gICAgICAgIGAgICAgICAgIFwiJHt2ZXJzaW9ufS0ke3R5cGV9XCI6IChcIiR7ZmlsZW5hbWV9XCIsIFwiJHtzdHJpcHBlZEZpbGVuYW1lfVwiLCBcIiR7c2hhfVwiKSxgLFxuICAgICAgKTtcbiAgICB9XG5cbiAgICBjb25zb2xlLmxvZyhgICAgIH0sYCk7XG4gICAgY29uc29sZS5sb2coYCAgICBub2RlX3ZlcnNpb24gPSBcIiR7dmVyc2lvbn1cIixgKTtcbiAgICBjb25zb2xlLmxvZyhgKVxcbmApO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIExvZy5lcnJvcihgICDinJggIEFib3J0ZWQgZHVlIHRvIGFuIGVycm9yOlxcbiR7ZXJyb3J9YCk7XG4gICAgcHJvY2Vzcy5leGl0KDEpO1xuICB9XG59XG4iXX0=