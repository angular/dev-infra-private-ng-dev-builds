{"version":3,"file":"print-active-trains.js","sourceRoot":"","sources":["print-active-trains.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright Google LLC\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n\nimport {blue, bold, underline, Log} from '../../utils/logging.js';\nimport {ReleaseConfig} from '../config/index.js';\n\nimport {ActiveReleaseTrains} from './active-release-trains.js';\nimport {fetchLongTermSupportBranchesFromNpm} from './long-term-support.js';\nimport {isVersionPublishedToNpm} from './npm-registry.js';\n\n/**\n * Prints the active release trains to the console.\n * @params active Active release trains that should be printed.\n * @params config Release configuration used for querying NPM on published versions.\n */\nexport async function printActiveReleaseTrains(\n  active: ActiveReleaseTrains,\n  config: ReleaseConfig,\n): Promise<void> {\n  const {releaseCandidate, next, latest, exceptionalMinor} = active;\n  const isNextPublishedToNpm = await isVersionPublishedToNpm(next.version, config);\n  const nextTrainType = next.isMajor ? 'major' : 'minor';\n  const ltsBranches = await fetchLongTermSupportBranchesFromNpm(config);\n\n  Log.info();\n  Log.info(blue('Current version branches in the project:'));\n\n  if (exceptionalMinor !== null) {\n    const version = exceptionalMinor.version;\n    const exceptionalMinorPublished = await isVersionPublishedToNpm(version, config);\n    const trainPhase = version.prerelease[0] === 'next' ? 'next' : 'release-candidate';\n    const minorLabel = underline('exceptional minor');\n\n    Log.info(\n      ` • ${bold(exceptionalMinor.branchName)} contains changes for an ${minorLabel} ` +\n        `that is currently in ${bold(trainPhase)} phase.`,\n    );\n    // An exceptional minor may not be published yet. e.g. when we branch off there\n    // will not be a release immediately.\n    if (exceptionalMinorPublished) {\n      Log.info(`   Most recent pre-release for this branch is \"${bold(`v${version}`)}\".`);\n    } else {\n      Log.info(`   Version is set to \"${bold(`v${version}`)}\", but has not been published yet.`);\n    }\n  }\n\n  // Print information for release trains in the feature-freeze/release-candidate phase.\n  if (releaseCandidate !== null) {\n    const rcVersion = releaseCandidate.version;\n    const rcTrainType = releaseCandidate.isMajor ? 'major' : 'minor';\n    const rcTrainPhase =\n      rcVersion.prerelease[0] === 'next' ? 'feature-freeze' : 'release-candidate';\n    Log.info(\n      ` • ${bold(releaseCandidate.branchName)} contains changes for an upcoming ` +\n        `${rcTrainType} that is currently in ${bold(rcTrainPhase)} phase.`,\n    );\n    Log.info(`   Most recent pre-release for this branch is \"${bold(`v${rcVersion}`)}\".`);\n  }\n\n  // Print information about the release-train in the latest phase. i.e. the patch branch.\n  Log.info(` • ${bold(latest.branchName)} contains changes for the most recent patch.`);\n  Log.info(`   Most recent patch version for this branch is \"${bold(`v${latest.version}`)}\".`);\n\n  // Print information about the release-train in the next phase.\n  Log.info(\n    ` • ${bold(next.branchName)} contains changes for a ${nextTrainType} ` +\n      `currently in active development.`,\n  );\n  // Note that there is a special case for versions in the next release-train. The version in\n  // the next branch is not always published to NPM. This can happen when we recently branched\n  // off for a feature-freeze release-train. More details are in the next pre-release action.\n  if (isNextPublishedToNpm) {\n    Log.info(\n      `   Most recent pre-release version for this branch is \"${bold(`v${next.version}`)}\".`,\n    );\n  } else {\n    Log.info(\n      `   Version is currently set to \"${bold(`v${next.version}`)}\", but has not been ` +\n        `published yet.`,\n    );\n  }\n\n  // If no release-train in release-candidate or feature-freeze phase is active,\n  // we print a message as last bullet point to make this clear.\n  if (releaseCandidate === null) {\n    Log.info(' • No release-candidate or feature-freeze branch currently active.');\n  }\n\n  Log.info();\n  Log.info(blue('Current active LTS version branches:'));\n\n  // Print all active LTS branches (each branch as own bullet point).\n  if (ltsBranches.active.length !== 0) {\n    for (const ltsBranch of ltsBranches.active) {\n      Log.info(` • ${bold(ltsBranch.name)} is currently in active long-term support phase.`);\n      Log.info(\n        `   Most recent patch version for this branch is \"${bold(`v${ltsBranch.version}`)}\".`,\n      );\n    }\n  }\n\n  Log.info();\n}\n"]}